<!DOCTYPE html>
<html lang="fr">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1, user-scalable=no">
    <title>Fiches Exercices Concours</title>
    <script src="https://cdn.jsdelivr.net/npm/mathjax@3/es5/tex-svg.js"></script>
    <style>
        body {
            font-family: sans-serif;
            margin: 0; padding: 10px;
            background: #f8f9fa;
        }
        .fiche {
            background: #fff;
            border-radius: 8px; padding: 15px; margin: 10px auto;
            max-width: 800px;
            box-shadow: 0 2px 5px rgba(0,0,0,0.1);
        }
        button {
            background: #007BFF; color: white; border: none;
            padding: 6px 12px; border-radius: 5px; cursor: pointer;
            margin-top: 8px;
        }
        .detail { display: none; margin-top: 10px; border-top: 1px solid #eee; padding-top: 8px; }
        mjx-container, svg { max-width: 100%; overflow-x: auto; }
    </style>
</head>
<body>

<div id="container"></div>

<script>
// Fonction de gestion affichage détails
function toggleDetail(btn){
    let d = btn.nextElementSibling;
    if(d.style.display === "block"){
        d.style.display = "none"; btn.textContent = "Afficher les détails";
    }else{
        d.style.display = "block"; btn.textContent = "Masquer les détails";
        MathJax.typesetPromise();
    }
}

// Chargement CSV robuste
async function loadCSV(url){
    const res = await fetch(url);
    const text = await res.text();
    const lines = text.trim().split('\n');
    const headers = lines.shift().split(',');

    return lines.map(line => {
        let entries = [];
        let entry = '', inQuotes = false;
        for(let char of line){
            if(char === '"' && !inQuotes){ inQuotes = true; continue; }
            if(char === '"' && inQuotes){ inQuotes = false; continue; }
            if(char === ',' && !inQuotes){ entries.push(entry.trim()); entry=''; continue; }
            entry += char;
        }
        entries.push(entry.trim());
        const obj = {};
        headers.forEach((h,i)=>obj[h.trim()]=entries[i]);
        return obj;
    });
}

// Génération HTML avec gestion automatique des listes
function generateHTML(data){
    const cont = document.getElementById('container');
    data.forEach(fiche=>{
        const el = document.createElement('div');
        el.className = 'fiche';

        let detailHTML = '<i>Aucun descriptif détaillé fourni.</i>';
        if (fiche.descriptif_detaille.trim()) {
            const items = fiche.descriptif_detaille.split(';').map(item => item.trim());
            detailHTML = '<ul>' + items.map(item => `<li>${item}</li>`).join('') + '</ul>';
        }

        el.innerHTML = `
        <h2>${fiche.concours} - ${fiche.exercice}</h2>
        <div>${fiche.descriptif_court}</div>
        <button onclick="toggleDetail(this)">Afficher les détails</button>
        <div class="detail">
          ${detailHTML}
        </div>
        <div><strong>Intérêt :</strong> ${fiche.interet}</div>
        <div><strong>Difficulté :</strong> ${fiche.difficulte}</div>
        <div><strong>Rencontré lors de… :</strong> ${fiche.rencontre}</div>
        `;
        cont.appendChild(el);
    });
    MathJax.typesetPromise();
}


document.addEventListener('DOMContentLoaded',()=>{
    loadCSV('fiches.csv').then(generateHTML);
});
</script>

</body>
</html>
